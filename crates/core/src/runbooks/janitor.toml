# Janitor System Configuration
# Automatically cleans up stale resources and maintains system hygiene.
#
# This configuration defines scanners that clean up:
# - Stale locks (locks held past their heartbeat window)
# - Orphaned worktrees (git worktrees without active pipelines)
# - Dead queue items (items that exceeded retry limits)
# - Old pipeline state (completed pipelines past retention)

[meta]
name = "janitor"
description = "Resource cleanup and maintenance"
version = "1.0.0"

# ========================================
# Scanners
# ========================================
# Scanners periodically scan resources and clean up those matching conditions.

[scanner.stale-locks]
name = "Clean up stale locks"
source = "locks"
condition = { type = "stale", threshold = "1h" }
cleanup_action = "release"
scan_interval = "10m"

[scanner.stale-semaphores]
name = "Clean up stale semaphore slots"
source = "semaphores"
condition = { type = "stale", threshold = "1h" }
cleanup_action = "release"
scan_interval = "10m"

[scanner.orphan-worktrees]
name = "Clean up orphaned git worktrees"
source = "worktrees"
condition = "orphaned"
cleanup_action = "delete"
scan_interval = "30m"

[scanner.dead-queue-items]
name = "Move exhausted items to dead letter"
source = { type = "queue", name = "merges" }
condition = { type = "exceeded_attempts", max = 3 }
cleanup_action = "dead_letter"
scan_interval = "5m"

[scanner.old-pipelines]
name = "Archive completed pipelines"
source = "pipelines"
condition = { type = "terminal_for", threshold = "24h" }
cleanup_action = { type = "archive", destination = ".oj/archive" }
scan_interval = "1h"

[scanner.stale-sessions]
name = "Clean up dead sessions"
source = "sessions"
condition = { type = "stale", threshold = "2h" }
cleanup_action = "delete"
scan_interval = "15m"

[scanner.temp-branches]
name = "Clean up temporary branches"
source = "worktrees"
condition = { type = "matches", pattern = "temp-" }
cleanup_action = "delete"
scan_interval = "1h"
